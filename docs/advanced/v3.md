# API v3
**API URL**: ``https://next.fateslist.xyz`` (for now, can change in future)

## Authorization

- **Bot:** These endpoints require a bot token. 
You can get this from Bot Settings. Make sure to keep this safe and in 
a .gitignore/.env. A prefix of `Bot` before the bot token such as 
`Bot abcdef` is supported and can be used to avoid ambiguity but is not 
required. The default auth scheme if no prefix is given depends on the
endpoint: Endpoints which have only one auth scheme will use that auth 
scheme while endpoints with multiple will always use `Bot` for 
backward compatibility

- **Server:** These endpoints require a server
token which you can get using ``/get API Token`` in your server. 
Same warnings and information from the other authentication types 
apply here. A prefix of ``Server`` before the server token is 
supported and can be used to avoid ambiguity but is not required.

- **User:** These endpoints require a user token. You can get this 
from your profile under the User Token section. If you are using this 
for voting, make sure to allow users to opt out! A prefix of `User` 
before the user token such as `User abcdef` is supported and can be 
used to avoid ambiguity but is not required outside of endpoints that 
have both a user and a bot authentication option such as Get Votes. 
In such endpoints, the default will always be a bot auth unless 
you prefix the token with `User`

## Base Response

A default API Response will be of the below format:

```json
{
    "done": true,
    "reason": "Reason for success of failure, can be null",
    "context": "Any extra context"
}
```

## Core

### Index
#### GET /index

Returns the index for bots and servers

**API v2 analogue:** (no longer working) [Get Index](https://api.fateslist.xyz/docs/redoc#operation/get_index)

**Query parameters**

- **target_type** [String? | default = bot (type info may be incomplete, see example)]


**Example**

```json
{
    "target_type": "bot"
}
```

**Request Body**

```json
{}
```

**Response Body**

```json
{
    "new": [
        {
            "guild_count": 0,
            "description": "",
            "banner": "",
            "nsfw": false,
            "votes": 0,
            "state": 0,
            "user": {
                "id": "",
                "username": "",
                "disc": "",
                "avatar": "",
                "bot": false
            }
        }
    ],
    "top_voted": [
        {
            "guild_count": 0,
            "description": "",
            "banner": "",
            "nsfw": false,
            "votes": 0,
            "state": 0,
            "user": {
                "id": "",
                "username": "",
                "disc": "",
                "avatar": "",
                "bot": false
            }
        }
    ],
    "certified": [
        {
            "guild_count": 0,
            "description": "",
            "banner": "",
            "nsfw": false,
            "votes": 0,
            "state": 0,
            "user": {
                "id": "",
                "username": "",
                "disc": "",
                "avatar": "",
                "bot": false
            }
        }
    ],
    "tags": [
        {
            "name": "",
            "iconify_data": "",
            "id": "",
            "owner_guild": null
        }
    ],
    "features": [
        {
            "id": "",
            "name": "",
            "viewed_as": "",
            "description": ""
        }
    ]
}
```


### Resolve Vanity
#### GET /code/{code}

Resolves the vanity for a bot/server in the list

**API v2 analogue:** (no longer working) [Get Vanity](https://api.fateslist.xyz/docs/redoc#operation/get_vanity)

**Path parameters**

- **code** [String (type info may be incomplete, see example)]


**Example**

```json
{
    "code": "my-vanity"
}
```

**Request Body**

```json
{}
```

**Response Body**

```json
{
    "target_type": "bot | server",
    "target_id": "0000000000"
}
```


### Get Bot
#### GET /bots/{id}


Fetches bot information given a bot ID. If not found, 404 will be returned. 

This endpoint handles both bot IDs and client IDs

Differences from API v2:

- Unlike API v2, this does not support compact or no_cache. Owner order is also guaranteed
- *``long_description/css`` is sanitized with ammonia by default, use `long_description_raw` if you want the unsanitized version*
- All responses are cached for a short period of time. There is *no* way to opt out unlike API v2
- Some fields have been renamed or removed (such as ``promos`` which may be readded at a later date)

**Set the Frostpaw header if you are a custom client**


**API v2 analogue:** [Fetch Bot](https://api.fateslist.xyz/docs/redoc#operation/fetch_bot)

**Path parameters**

- **id** [i64 (type info may be incomplete, see example)]


**Example**

```json
{
    "id": 0
}
```

**Query parameters**

- **lang** [Optional <String> (type info may be incomplete, see example)]


**Example**

```json
{
    "lang": null
}
```

**Request Body**

```json
{}
```

**Response Body**

```json
{
    "user": {
        "id": "",
        "username": "",
        "disc": "",
        "avatar": "",
        "bot": false
    },
    "description": "",
    "tags": [],
    "created_at": "1970-01-01T00:00:00Z",
    "last_stats_post": "1970-01-01T00:00:00Z",
    "long_description": "blah blah blah",
    "long_description_raw": "blah blah blah unsanitized",
    "long_description_type": 2,
    "guild_count": 0,
    "shard_count": 493,
    "user_count": 0,
    "shards": [],
    "prefix": null,
    "library": "",
    "invite": null,
    "invite_link": "https://discord.com/api/oauth2/authorize....",
    "invite_amount": 48,
    "owners": [
        {
            "user": {
                "id": "",
                "username": "",
                "disc": "",
                "avatar": "",
                "bot": false
            },
            "main": false
        }
    ],
    "owners_html": "",
    "features": [
        {
            "id": "",
            "name": "",
            "viewed_as": "",
            "description": ""
        }
    ],
    "state": 0,
    "page_style": 1,
    "website": null,
    "support": "",
    "github": null,
    "css": "<style></style>",
    "votes": 0,
    "total_votes": 0,
    "vanity": "",
    "donate": null,
    "privacy_policy": null,
    "nsfw": false,
    "banner_card": null,
    "banner_page": null,
    "keep_banner_decor": false,
    "client_id": "",
    "flags": [],
    "action_logs": [
        {
            "user_id": "",
            "action": 0,
            "action_time": "1970-01-01T00:00:00Z",
            "context": null
        }
    ],
    "uptime_checks_total": 30,
    "uptime_checks_failed": 19,
    "commands": {
        "default": [
            {
                "cmd_type": 0,
                "cmd_groups": [],
                "cmd_name": "",
                "vote_locked": false,
                "description": "",
                "args": [],
                "examples": [],
                "premium_only": false,
                "notes": [],
                "doc_link": "",
                "id": ""
            }
        ]
    },
    "resources": [
        {
            "id": "",
            "resource_title": "",
            "resource_link": "",
            "resource_description": ""
        }
    ]
}
```


### Search List
#### GET /search?q={query}

Searches the list based on a query named ``q``

**API v2 analogue:** (no longer working) [Fetch Bot](https://api.fateslist.xyz/docs/redoc#operation/search_list)

**Query parameters**

- **q** [String? | default = mew (type info may be incomplete, see example)]


**Example**

```json
{
    "q": "mew"
}
```

**Request Body**

```json
{}
```

**Response Body**

```json
{
    "bots": [
        {
            "guild_count": 0,
            "description": "",
            "banner": "",
            "nsfw": false,
            "votes": 0,
            "state": 0,
            "user": {
                "id": "",
                "username": "",
                "disc": "",
                "avatar": "",
                "bot": false
            }
        }
    ],
    "servers": [
        {
            "guild_count": 0,
            "description": "",
            "banner": "",
            "nsfw": false,
            "votes": 0,
            "state": 0,
            "user": {
                "id": "",
                "username": "",
                "disc": "",
                "avatar": "",
                "bot": false
            }
        }
    ],
    "profiles": [
        {
            "banner": "",
            "description": "",
            "user": {
                "id": "",
                "username": "",
                "disc": "",
                "avatar": "",
                "bot": false
            }
        }
    ],
    "packs": [
        {
            "id": "0",
            "name": "",
            "description": "",
            "icon": "",
            "banner": "",
            "resolved_bots": [
                {
                    "user": {
                        "id": "",
                        "username": "",
                        "disc": "",
                        "avatar": "",
                        "bot": false
                    },
                    "description": ""
                }
            ],
            "owner": {
                "id": "",
                "username": "",
                "disc": "",
                "avatar": "",
                "bot": false
            },
            "created_at": "1970-01-01T00:00:00Z"
        }
    ],
    "tags": {
        "bots": [
            {
                "name": "",
                "iconify_data": "",
                "id": "",
                "owner_guild": null
            }
        ],
        "servers": [
            {
                "name": "",
                "iconify_data": "",
                "id": "",
                "owner_guild": null
            }
        ]
    }
}
```


### Random Bot
#### GET /random-bot


Fetches a random bot on the list

Example:
```py
import requests

def random_bot():
    res = requests.get(api_url"/random-bot")
    json = res.json()
    if res.status != 200:
        # Handle an error in the api
        ...
    return json
```


**API v2 analogue:** (no longer working) [Fetch Random Bot](https://api.fateslist.xyz/api/docs/redoc#operation/fetch_random_bot)

**Request Body**

```json
{}
```

**Response Body**

```json
{
    "guild_count": 0,
    "description": "",
    "banner": "",
    "nsfw": false,
    "votes": 0,
    "state": 0,
    "user": {
        "id": "",
        "username": "",
        "disc": "",
        "avatar": "",
        "bot": false
    }
}
```


### Random Server
#### GET /random-server


Fetches a random server on the list

Example:
```py
import requests

def random_server():
    res = requests.get(api_url"/random-server")
    json = res.json()
    if res.status != 200:
        # Handle an error in the api
        ...
    return json
```


**API v2 analogue:** (no longer working) [Fetch Random Server](https://api.fateslist.xyz/api/docs/redoc#operation/fetch_random_server)

**Request Body**

```json
{}
```

**Response Body**

```json
{
    "guild_count": 0,
    "description": "",
    "banner": "",
    "nsfw": false,
    "votes": 0,
    "state": 0,
    "user": {
        "id": "",
        "username": "",
        "disc": "",
        "avatar": "",
        "bot": false
    }
}
```


### Get Server
#### GET /servers/{id}


Fetches server information given a server/guild ID. If not found, 404 will be returned. 

Differences from API v2:

- Unlike API v2, this does not support compact or no_cache.
- *``long_description/css`` is sanitized with ammonia by default, use `long_description_raw` if you want the unsanitized version*
- All responses are cached for a short period of time. There is *no* way to opt out unlike API v2
- Some fields have been renamed or removed

**Set the Frostpaw header if you are a custom client**


**API v2 analogue:** (no longer working) [Fetch Server](https://api.fateslist.xyz/docs/redoc#operation/fetch_server)

**Path parameters**

- **id** [i64 (type info may be incomplete, see example)]


**Example**

```json
{
    "id": 0
}
```

**Query parameters**

- **lang** [Optional <String> (type info may be incomplete, see example)]


**Example**

```json
{
    "lang": null
}
```

**Request Body**

```json
{}
```

**Response Body**

```json
{
    "user": {
        "id": "",
        "username": "",
        "disc": "",
        "avatar": "",
        "bot": false
    },
    "description": "",
    "tags": [],
    "long_description_type": 0,
    "long_description": "",
    "long_description_raw": "",
    "vanity": null,
    "guild_count": 0,
    "invite_amount": 0,
    "created_at": "1970-01-01T00:00:00Z",
    "state": 0,
    "flags": [],
    "css": "",
    "website": null,
    "banner_card": null,
    "banner_page": null,
    "keep_banner_decor": false,
    "nsfw": false,
    "votes": 0,
    "total_votes": 0
}
```


## Auth

### Get OAuth2 Link
#### GET /oauth2

Returns the oauth2 link used to login with

**API v2 analogue:** (no longer working) [Get OAuth2 Link](https://api.fateslist.xyz/docs/redoc#operation/get_oauth2_link)

**Request Body**

```json
{}
```

**Response Body**

```json
{
    "done": true,
    "reason": null,
    "context": "https://discord.com/........."
}
```


### Delete OAuth2 Login
#### DELETE /oauth2


'Deletes' (logs out) a oauth2 login. Always call this when logging out 
even if you do not use cookies as it may perform other logout tasks in future

This API is essentially a logout


**API v2 analogue:** (no longer working) [Logout Sunbeam](https://api.fateslist.xyz/docs/redoc#operation/logout_sunbeam)

**Request Body**

```json
{}
```

**Response Body**

```json
{
    "done": true,
    "reason": null,
    "context": null
}
```


